{"version":3,"file":"async-homeDashboard.js","mappings":";;;;;;;;;;;;;;;;;;AAAA,CAAkE;AAClE,2CAAK,UAAU,wDAAkB,EAAE,gDAAU;AACI;AACA;AACX;AACtC;AACe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,uBAAuB;AAC/C;AACA,8DAA8D,YAAY;AAC1E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gEAAgE,8BAA8B;AAC9F;AACA;AACA;AACA;AACA;AACA,mCAAmC,EAAE;AACrC,kCAAkC,EAAE;AACpC;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC,+DAAa;AAC/C;AACA;AACA;AACA,SAAS;AACT;AACA,QAAQ,CAAC;AACT,wBAAwB,CAAC;AACzB;AACA;AACA,cAAc;AACd;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C,2CAAK;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,aAAa;AACb;AACA,SAAS;AACT;AACA;AACA,0CAA0C,2CAAK;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,aAAa;AACb;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,gBAAgB,mDAAU;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd,gBAAgB,mDAAU,cAAc,+CAA+C;AACvF,gBAAgB,mDAAU;AAC1B;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA,yBAAyB,8DAAwB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,mDAAU;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,6BAA6B;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iEAAiE,YAAY;AAC7E,wCAAwC,gDAAgD;AACxF,cAAc,gDAAgD;AAC9D;AACA;AACA,oEAAoE,YAAY;AAChF;AACA,8BAA8B,gDAAgD;AAC9E,mCAAmC,gDAAgD;AACnF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iEAAiE,qDAAqD;AACtH,mDAAmD,qDAAqD,IAAI,qDAAqD;AACjK,oDAAoD,uDAAuD,IAAI,uDAAuD;AACtK;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,uBAAuB;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kEAAkE,YAAY;AAC9E;AACA;AACA;AACA;AACA;AACA;AACA,sEAAsE,YAAY;AAClF;AACA;AACA;AACA,qEAAqE,YAAY;AACjF,iEAAiE,YAAY;AAC7E,wCAAwC,gDAAgD;AACxF,cAAc,uCAAuC;AACrD;AACA,+DAA+D,YAAY;AAC3E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,YAAY;AAC1D;AACA;AACA,+CAA+C,YAAY;AAC3D;AACA;AACA;AACA;AACA,cAAc;AACd,wEAAwE,YAAY;AACpF;AACA;AACA,8BAA8B,gDAAgD;AAC9E,mCAAmC,gDAAgD;AACnF;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uDAAuD,MAAM;AAC7D,4CAA4C,sBAAsB;AAClE,6CAA6C,sBAAsB;AACnE;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,YAAY;AAC7C;AACA,gCAAgC,YAAY;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAyC,YAAY;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C,YAAY;AACzD;AACA,6CAA6C,gDAAgD;AAC7F,cAAc,uCAAuC;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C,YAAY;AACtD;AACA;AACA,2CAA2C,YAAY;AACvD;AACA;AACA,8BAA8B,gDAAgD;AAC9E,mCAAmC,gDAAgD;AACnF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC,YAAY;AACpD,mDAAmD,MAAM;AACzD;AACA,wCAAwC,sBAAsB;AAC9D,yCAAyC,sBAAsB;AAC/D;AACA;AACA,mEAAmE,YAAY;AAC/E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kEAAkE,GAAG;AACrE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://thebudgeteer/../../../../../C\u0000# Academy Repos/CodeReviews.MVC.Budget/MVC.Budget.K-MYR/MVC.Budget.K-MYR/ClientApp/src/js/homeDashboard.js"],"sourcesContent":["ï»¿import { ArcElement, Chart, DoughnutController } from 'chart.js';\r\nChart.register(DoughnutController, ArcElement);\r\nimport { getDatePicker } from './asyncComponents'\r\nimport { getFiscalPlanDataByMonth } from './api';\r\nimport messageBox from './messageBox';\r\n\r\nexport default class HomeDashboard {\r\n    #data;\r\n    #isLoading;\r\n    #monthPicker;\r\n    #sentimentChartMonthly;\r\n    #necessityChartMonthly;\r\n    #overspendingHeading;\r\n    #incomeBalanceHeader;\r\n    #incomeAccordionBody;\r\n    #expenseBalanceHeader;\r\n    #expenseAccordionBody;\r\n    #menu;\r\n\r\n    constructor(menu, id, date, data) {\r\n        this.#data = data;\r\n        this.#menu = menu;      \r\n        this.#init(id, date);\r\n    }\r\n\r\n    async #init(id, date) {\r\n        try {\r\n            this.#isLoading = true;\r\n            var datepickerPromise = this.#initializeDatePicker(id, date);\r\n            var chartPromise = this.#initializeCharts();            \r\n\r\n            this.#overspendingHeading = document.getElementById('home-overspending');\r\n\r\n            this.#incomeBalanceHeader = document.getElementById('incomeBalanceHeader');\r\n            this.#incomeAccordionBody = document.getElementById('incomeAccordionBody');\r\n\r\n            this.#expenseBalanceHeader = document.getElementById('expensesBalanceHeader');\r\n            this.#expenseAccordionBody = document.getElementById('expensesAccordionBody');  \r\n            \r\n            this.#formatHeaders();   \r\n            this.#formatCategories();\r\n            await datepickerPromise;\r\n            await chartPromise;\r\n        } finally {\r\n            this.#isLoading = false;\r\n        }        \r\n    }\r\n\r\n    attachMenuHandlers() {\r\n        var categories = this.#data.incomeCategories.concat(this.#data.expenseCategories);\r\n\r\n        for (let i = 0; i < categories.length; i++) {\r\n            let category = categories[i];\r\n            let element = document.getElementById(`category_${category.id}`);\r\n\r\n            if (element) {\r\n                element.addEventListener(\"click\", this.#onCategoryClick.bind(this));\r\n            }     \r\n        }\r\n    }\r\n\r\n    #onCategoryClick(event) {\r\n        var categoryElement = event.target.closest('.category');\r\n        var id = categoryElement.dataset.id;\r\n        if (this.#menu.dataset.categoryid != 0) {\r\n            let borderBox = document.getElementById(`category_${this.#menu.dataset.categoryid}`).querySelector('.border-animation');\r\n            borderBox.classList.remove('border-rotate');\r\n        }\r\n        var y = Math.max(Math.min(event.pageY - 100, window.innerHeight - 200), 66);\r\n        var x = Math.max(Math.min(event.pageX - 100, window.innerWidth - 220), 20);\r\n        this.#menu.dataset.categoryid = id;\r\n        this.#menu.style.left = `${x}px`;\r\n        this.#menu.style.top = `${y}px`;\r\n        this.#menu.classList.add('active');\r\n\r\n        categoryElement.querySelector('.border-animation').classList.add('border-rotate');\r\n    }\r\n\r\n    async #initializeDatePicker(id, date) {\r\n        this.#monthPicker = await getDatePicker(\"#home-monthSelector\", \"month\")\r\n        this.#monthPicker.datepicker('setDate', date.toISOString());\r\n        this.#monthPicker.on('changeDate', async () => {\r\n            this.#refresh(id, this.#monthPicker.datepicker('getUTCDate'));\r\n        });\r\n\r\n        $('.monthPicker .calendar-button').on('click', function () {\r\n            var input = $(this).siblings('.monthSelector');\r\n            if (!input.data('datepicker').picker.is(':visible')) {\r\n                input.datepicker('show');\r\n            } else {\r\n                input.datepicker('hide');\r\n            }\r\n        });\r\n    }\r\n\r\n    #initializeCharts() {\r\n        var options = {\r\n            responsive: true,\r\n            layout: {\r\n                padding: 2\r\n            },\r\n            maintainAspectRatio: false,\r\n            plugins: {\r\n                tooltip: {\r\n                    callbacks: {\r\n                        label: function (context) {\r\n                            var label = context.dataset.label || '';\r\n\r\n                            if (label) {\r\n                                label += ': ';\r\n                            }\r\n                            if (context.parsed.y !== null) {\r\n                                label += window.userNumberFormat.format(context.parsed);\r\n                            }\r\n                            return label;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        var sentimentChart = document.getElementById('sentimentChart');\r\n        this.#sentimentChartMonthly = new Chart(sentimentChart, {\r\n            type: 'doughnut',\r\n            data: {\r\n                labels: [\r\n                    'Happy',\r\n                    'Unhappy'\r\n                ],\r\n                datasets: [{\r\n                    label: 'Total Amount',\r\n                    data: [this.#data.expensesHappyTotal, this.#data.expensesTotal - this.#data.expensesHappyTotal],\r\n                    backgroundColor: [\r\n                        'rgb(25,135,84)',\r\n                        'rgb(220,53,69)'\r\n                    ],\r\n                    hoverOffset: 4\r\n                }]\r\n            },\r\n            options: options\r\n        });\r\n\r\n        var necessityChart = document.getElementById('necessityChart');\r\n        this.#necessityChartMonthly = new Chart(necessityChart, {\r\n            type: 'doughnut',\r\n            data: {\r\n                labels: [\r\n                    'Necessary',\r\n                    'Unnecessary'\r\n                ],\r\n                datasets: [{\r\n                    label: 'Total Amount',\r\n                    data: [this.#data.expensesNecessaryTotal, this.#data.expensesTotal - this.#data.expensesNecessaryTotal],\r\n                    backgroundColor: [\r\n                        'rgb(25,135,84)',\r\n                        'rgb(220,53,69)'\r\n                    ],\r\n                    hoverOffset: 4\r\n                }]\r\n            },\r\n            options: options\r\n        });\r\n    }\r\n\r\n    async #refresh(id, date) {        \r\n        try {\r\n            if (this.#isLoading) {\r\n                messageBox.addAndShow('The dashboard is loading...', '#info-icon');\r\n            }\r\n\r\n            this.#isLoading = true;\r\n            let response = await this.#getData(id, date);\r\n            if (response.isSuccess) {\r\n                this.#renderData(response.data);\r\n            } else {\r\n                messageBox.addMessage({ text: response.message, iconId: '#cross-icon' });\r\n                messageBox.show();\r\n            }\r\n            \r\n        } finally {\r\n            this.#isLoading = false;\r\n        }\r\n    }   \r\n\r\n    async #getData(id, date) {\r\n        var data = await getFiscalPlanDataByMonth(id, date);\r\n        return data;\r\n    }\r\n\r\n    formatDashboard(data) {\r\n        try {\r\n            if (this.#isLoading) {\r\n                messageBox.addAndShow('The dashboard is loading...', '#info-icon');\r\n                return false;\r\n            }\r\n            this.#isLoading = true;\r\n\r\n            this.#formatHeaders(data);\r\n            this.#formatCategories(data); \r\n            this.#formatCharts(data);\r\n            \r\n        } finally {\r\n            this.#isLoading = false;\r\n        }\r\n    }\r\n\r\n    #formatCategories(data) {\r\n        var dataObj = data ?? this.#data;\r\n\r\n        if (dataObj == null) {\r\n            return false;\r\n        }\r\n\r\n        var categoryElements = this.#data.incomeCategories.concat(this.#data.expenseCategories);\r\n\r\n        for (let i = 0; i < categoryElements.length; i++) {\r\n            this.#formatCategory(categoryElements[i]);\r\n        }  \r\n        return true;\r\n    }\r\n\r\n    #formatCategory(category) {\r\n        if (!category) {\r\n            return false;\r\n        }\r\n        var balanceElement = document.getElementById(`category_${category.id}_balance`);\r\n        balanceElement.textContent = `${window.userNumberFormat.format(category.total)} / \r\n            ${window.userNumberFormat.format(category.budget)}`;\r\n        if (category.total > category.budget) {\r\n            let deviationAmount = category.total - category.budget;\r\n            let deviationSpan = document.getElementById(`category_${category.id}_deviationText`);\r\n            deviationSpan.textContent = category.categoryType === 1\r\n                ? `Surplus: ${window.userNumberFormat.format(deviationAmount)}`\r\n                : `Overspending: ${window.userNumberFormat.format(deviationAmount)}`;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    #formatCharts(data) {\r\n        var dataObj = data ?? this.#data;\r\n\r\n        if (dataObj == null) {\r\n            return false;\r\n        }\r\n        this.#sentimentChartMonthly.data.datasets[0].data = [dataObj.expensesHappyTotal, dataObj.expensesTotal - dataObj.expensesHappyTotal, Number.MIN_VALUE];\r\n        this.#sentimentChartMonthly.update();\r\n\r\n        this.#necessityChartMonthly.data.datasets[0].data = [dataObj.expensesNecessaryTotal, dataObj.expensesTotal - dataObj.expensesNecessaryTotal, Number.MIN_VALUE];\r\n        this.#necessityChartMonthly.update();\r\n\r\n        return true;\r\n    }\r\n\r\n    #formatHeaders(data) {\r\n        var dataObj = data ?? this.#data;\r\n\r\n        if (dataObj == null) {\r\n            return false;\r\n        }\r\n       \r\n        this.#overspendingHeading.textContent = `Overspending: ${window.userNumberFormat.format(dataObj.overspending)}`;\r\n        this.#incomeBalanceHeader.textContent = `${window.userNumberFormat.format(dataObj.incomeTotal)} / ${window.userNumberFormat.format(dataObj.incomeBudget)}`;\r\n        this.#expenseBalanceHeader.textContent = `${window.userNumberFormat.format(dataObj.expensesTotal)} / ${window.userNumberFormat.format(dataObj.expensesBudget)}`;\r\n\r\n        return true;\r\n    }\r\n\r\n    #renderData(data) {\r\n        var dataObj = data ?? this.#data;       \r\n\r\n        if (dataObj == null) {\r\n            return false;\r\n        }      \r\n\r\n        this.#formatCharts(dataObj);\r\n        this.#formatHeaders(dataObj);\r\n\r\n        this.#updateCategories(dataObj.incomeCategories);\r\n        this.#updateCategories(dataObj.expenseCategories);\r\n\r\n        return true;\r\n    }\r\n\r\n    #updateCategories(categories) {\r\n        if (categories.length == 0) {\r\n            return false;\r\n        }\r\n\r\n        for (let i = 0; i < categories.length; i++) {\r\n            this.#updateCategory(categories[i]);\r\n        }\r\n        return true;\r\n    }\r\n\r\n    #updateCategory(category) {\r\n        if (!category) {\r\n            return false;\r\n        }\r\n        var categoryElement = document.getElementById(`category_${category.id}`);\r\n\r\n        if (!categoryElement) {\r\n            this.addCategory(category);\r\n            return true;\r\n        }\r\n\r\n        var categoryNameElement = document.getElementById(`category_${category.id}_name`);\r\n        categoryNameElement.textContent = decodeURIComponent(category.name);        \r\n\r\n        var budget = category.budgetLimit?.budget ?? category.budget;\r\n        var progressBarElement = document.getElementById(`category_${category.id}_progressbar`)\r\n        var balanceElement = document.getElementById(`category_${category.id}_balance`)\r\n        balanceElement.textContent = `${window.userNumberFormat.format(category.total)} / \r\n            ${window.userNumberFormat.format(budget)}`;\r\n\r\n        var deviationDiv = document.getElementById(`category_${category.id}_deviation`)\r\n\r\n        if (category.total > budget) {\r\n            let deviationSpan;\r\n            let deviationAmount = category.total - budget;\r\n            if (!deviationDiv) {\r\n                let categoryBodyDiv = categoryElement.querySelector('.category-body');\r\n                deviationDiv = document.createElement('div');\r\n                deviationDiv.className = 'category-body-content deviation';\r\n                deviationDiv.id = `category_${category.id}_deviation`;\r\n\r\n                deviationSpan = document.createElement('span');\r\n                deviationSpan.id = `category_${category.id}_deviationText`;\r\n                deviationSpan.className = 'deviation-text';\r\n\r\n                deviationDiv.appendChild(deviationSpan);\r\n                categoryBodyDiv.insertBefore(deviationDiv, balanceElement.parentElement);\r\n            } else {\r\n                deviationSpan = deviationDiv.querySelector(`#category_${category.id}_deviationText`);\r\n            }\r\n            deviationSpan.textContent = category.categoryType === 1\r\n                ? `Surplus: ${window.userNumberFormat.format(deviationAmount)}`\r\n                : `Overspending: ${window.userNumberFormat.format(deviationAmount)}`;\r\n\r\n        } else if (deviationDiv) {\r\n            deviationDiv.remove();\r\n        }\r\n\r\n        var progressBarPercentage = budget > 0 ? Math.min(100, Math.floor(category.total * 100 / budget)) : 100;\r\n        var color = \"bg-success\";\r\n        if (category.categoryType == 2) {\r\n            color = progressBarPercentage < 50 ? \"bg-success\" : progressBarPercentage < 85 ? \"bg-warning\" : \"bg-danger\";\r\n        }\r\n\r\n        progressBarElement.className = `progress-bar ${color}`;\r\n        progressBarElement.style.width = `${progressBarPercentage}%`;\r\n        progressBarElement.ariaValuenow = `${progressBarPercentage}`;\r\n\r\n        return true;\r\n    }    \r\n\r\n    #createCategoryElement(category) {\r\n        var mainDiv = document.createElement('div');\r\n        mainDiv.id = `category_${category.id}`;\r\n        mainDiv.className = 'category';\r\n        mainDiv.dataset.id = `${category.id}`;\r\n        mainDiv.addEventListener(\"click\", this.#onCategoryClick.bind(this));\r\n\r\n        var borderContainerDiv = document.createElement('div');\r\n        borderContainerDiv.className = 'border-container';\r\n\r\n        var contentDiv = document.createElement('div');\r\n        contentDiv.className = 'content';\r\n\r\n        var categoryBodyDiv = document.createElement('div');\r\n        categoryBodyDiv.className = 'category-body';\r\n\r\n        var categoryNameDiv = document.createElement('div');\r\n        categoryNameDiv.id = `category_${category.id}_name`;\r\n        categoryNameDiv.className = \"category-body-content\";\r\n        categoryNameDiv.textContent = decodeURIComponent(category.name);\r\n\r\n        var budget = category.budgetLimit?.budget ?? category.budget;\r\n\r\n        var categoryBalanceDiv = document.createElement('div');\r\n        categoryBalanceDiv.className = \"category-body-content balance\";\r\n\r\n        var categoryBalanceSpan = document.createElement('span');\r\n        categoryBalanceSpan.id = `category_${category.id}_balance`;\r\n        categoryBalanceSpan.className = 'balance-text';\r\n        categoryBalanceSpan.textContent = `${window.userNumberFormat.format(category.total)} / \r\n            ${window.userNumberFormat.format(budget)}`;\r\n\r\n        categoryBalanceDiv.appendChild(categoryBalanceSpan);\r\n        categoryBodyDiv.appendChild(categoryNameDiv);\r\n\r\n        if (category.total > category.budget) {\r\n            let deviationAmount = category.total - category.budget;\r\n            let deviationDiv = document.createElement('div');\r\n            deviationDiv.className = 'category-body-content deviation';\r\n            deviationDiv.id = `category_${category.id}_deviation`;\r\n\r\n            let deviationSpan = document.createElement('span');\r\n            deviationSpan.id = `category_${category.id}_deviationText`;\r\n            deviationSpan.className = 'deviation-text';\r\n            deviationSpan.textContent = category.categoryType === 1\r\n                ? `Surplus: ${window.userNumberFormat.format(deviationAmount)}`\r\n                : `Overspending: ${window.userNumberFormat.format(deviationAmount)}`;\r\n\r\n            deviationDiv.appendChild(deviationSpan);\r\n            categoryBodyDiv.appendChild(deviationDiv);\r\n        } \r\n\r\n        categoryBodyDiv.appendChild(categoryBalanceDiv);\r\n\r\n        var progressDiv = document.createElement('div');\r\n        progressDiv.className = 'progress';\r\n\r\n        var progressBarPercentage = budget > 0 ? Math.min(100, Math.floor(category.total * 100 / budget)) : 100;\r\n\r\n        var color = \"bg-success\";\r\n        if (category.categoryType == 2) {\r\n            color = progressBarPercentage < 50 ? \"bg-success\" : progressBarPercentage < 85 ? \"bg-warning\" : \"bg-danger\";\r\n        }\r\n\r\n        var progressBarDiv = document.createElement('div');\r\n        progressBarDiv.id = `category_${category.id}_progressbar`;\r\n        progressBarDiv.className = `progress-bar ${color}`;\r\n        progressBarDiv.role = 'progressbar';\r\n        progressBarDiv.style.width = `${progressBarPercentage}%`;\r\n        progressBarDiv.ariaValuenow = `${progressBarPercentage}`;\r\n        progressBarDiv.ariaValuemin = '0';\r\n        progressBarDiv.ariaValuemax = '100';\r\n        progressBarDiv.setAttribute('aria-labelledby', `category_${category.id}_balance`); \r\n\r\n        progressDiv.appendChild(progressBarDiv);\r\n\r\n        contentDiv.appendChild(categoryBodyDiv);\r\n        contentDiv.appendChild(progressDiv);\r\n\r\n        var borderAnimationDiv = document.createElement('div');\r\n        borderAnimationDiv.className = 'border-animation';\r\n\r\n        borderContainerDiv.appendChild(contentDiv);\r\n        borderContainerDiv.appendChild(borderAnimationDiv);\r\n\r\n        mainDiv.appendChild(borderContainerDiv);\r\n\r\n        return mainDiv;\r\n    }\r\n\r\n    getCategory(id) {\r\n        var categories = this.#data.incomeCategories.concat(this.#data.expenseCategories);\r\n        var category = categories.find(c => c.id == id);\r\n        return category;\r\n    }\r\n\r\n    addCategory(category) { \r\n        var categoryDTO =\r\n        {\r\n            id: category.id,\r\n            name: category.name,\r\n            budget: category.budget,            \r\n            categoryType: category.categoryType,\r\n            happyTotal: 0,\r\n            necessaryTotal: 0,           \r\n            total: 0\r\n        }\r\n\r\n        if (category.categoryType === 1) {\r\n            this.#data.incomeBudget += category.budget;\r\n        } else if (category.categoryType === 2) {\r\n            this.#data.expensesBudget += category.budget;\r\n        }  \r\n\r\n        var categoryElement = this.#createCategoryElement(categoryDTO);\r\n\r\n        var accordion = categoryDTO.categoryType == 1 ? this.#incomeAccordionBody : this.#expenseAccordionBody;\r\n        var array = categoryDTO.categoryType == 1 ? this.#data.incomeCategories : this.#data.expenseCategories;\r\n        var insertIndex = array.findIndex((object) => categoryDTO.name.localeCompare(object.name) < 0);\r\n\r\n        if (insertIndex === -1) {\r\n            array.push(categoryDTO);\r\n            accordion.appendChild(categoryElement);\r\n        } else {\r\n            array.splice(insertIndex, 0, categoryDTO);      \r\n            accordion.insertBefore(categoryElement, accordion.children[insertIndex]);\r\n        }\r\n\r\n        this.#formatCharts();\r\n        this.#formatHeaders();\r\n    }\r\n\r\n    editCategory(formData, month) {        \r\n        var type = parseInt(formData.get('Type'));\r\n        var id = parseInt(formData.get('Id'));\r\n        var name = formData.get(\"Name\");\r\n        var budget = parseFloat(formData.get(\"Budget\"));\r\n        var array;\r\n\r\n        switch (type) {\r\n            case 1:\r\n                array = this.#data.incomeCategories;\r\n                break;\r\n            case 2:\r\n                array = this.#data.expenseCategories;\r\n                break;\r\n            default:\r\n                return false;\r\n        }\r\n\r\n        var category = array.find(c => c.id === id);\r\n\r\n        if (!category) {\r\n            return false;\r\n        }\r\n\r\n        var oldBudget = category.budgetLimit?.budget ?? category.budget;\r\n\r\n        if (category.name == name && oldBudget == budget) {\r\n            return;\r\n        }\r\n\r\n        if (oldBudget != budget) {\r\n            let overspending = Math.max(0, category.total - oldBudget);\r\n            let newOverspending = Math.max(0, category.total - budget);\r\n            let diff = newOverspending - overspending;\r\n            this.#data.overspending += diff;\r\n            switch (type) {\r\n                case 1:\r\n                    this.#data.incomeBudget += budget - oldBudget;\r\n                    break;\r\n                case 2:\r\n                    this.#data.expensesBudget += budget - oldBudget;\r\n                    break;\r\n                default:\r\n                    return false;\r\n            }\r\n\r\n            this.#formatHeaders();\r\n            category.budgetLimit = { budget, month }\r\n        }\r\n\r\n        category.name = name;\r\n\r\n        this.#updateCategory(category);\r\n    }\r\n\r\n    removeCategory(id, type) {        \r\n        var categoryElement = document.getElementById(`category_${id}`);\r\n\r\n        if (!categoryElement) {\r\n            return false;\r\n        }\r\n\r\n        categoryElement.removeEventListener(\"click\", this.#onCategoryClick)\r\n        categoryElement.remove();\r\n\r\n        var array;\r\n\r\n        switch (type) {\r\n            case 1:\r\n                array = this.#data.incomeCategories;\r\n                break;\r\n            case 2:\r\n                array = this.#data.expenseCategories;\r\n                break;\r\n            default:\r\n                return false;\r\n        }\r\n        var index = array.findIndex(item => item.id === id);    \r\n        if (index !== -1) {\r\n            let category = array[index];\r\n            if (type === 1) {\r\n                this.#data.incomeTotal -= category.total;\r\n                this.#data.incomeBudget -= category.budget;\r\n            } else if (type === 2) {\r\n                this.#data.overspending -= Math.max(0, category.total - category.budget)\r\n                this.#data.expensesTotal -= category.total;\r\n                this.#data.expensesBudget -= category.budget;\r\n                this.#data.expensesHappyTotal -= category.happyTotal;\r\n                this.#data.expensesNecessaryTotal -= category.necessaryTotal;\r\n            }            \r\n            array.splice(index, 1);\r\n            this.#formatCharts();\r\n            this.#formatHeaders();\r\n        }\r\n        return true;\r\n    }\r\n\r\n    addTransaction(transaction) {\r\n        var transactionDate = new Date(transaction.dateTime)\r\n        var transactionYear = transactionDate.getYear();\r\n        var transactionMonth = transactionDate.getMonth();\r\n        var currentDate = this.getCurrentMonthUTC();\r\n        var currentYear = currentDate.getYear();\r\n        var currentMonth = currentDate.getMonth();\r\n\r\n        if (transactionYear === currentYear && transactionMonth == currentMonth) {\r\n            let array = this.#data.incomeCategories.concat(this.#data.expenseCategories);\r\n            let category = array.find((element) => element.id === transaction.categoryId);  \r\n            let overspending = Math.max(0, category.total - category.budget);   \r\n            \r\n            category.total += transaction.amount;\r\n            this.#data.overspending += Math.max(0, category.total - category.budget - overspending);\r\n\r\n            if (category.categoryType === 2) {\r\n                this.#data.expensesTotal += transaction.amount;\r\n                if (transaction.isHappy) {\r\n                    this.#data.expensesHappyTotal += transaction.amount;\r\n                }\r\n                if (transaction.isNecessary) {\r\n                    this.#data.expensesNecessaryTotal += transaction.amount;\r\n                }\r\n            } else if (category.categoryType === 1) {\r\n                this.#data.incomeTotal += transaction.amount;\r\n            }\r\n\r\n            if (transaction.isHappy) {\r\n                category.happyTotal += transaction.amount;\r\n            }\r\n            if (transaction.isNecessary) {\r\n                category.necessaryTotal += transaction.amount;\r\n            }\r\n\r\n            this.#formatHeaders();\r\n            this.#formatCharts();\r\n            this.#updateCategory(category);\r\n        }        \r\n    }\r\n\r\n    getCurrentMonthUTC = () => this.#monthPicker.datepicker('getUTCDate');\r\n    getCurrentMonth = () => this.#monthPicker.datepicker('getDate');        \r\n}\r\n"],"names":[],"sourceRoot":""}