@using System.Globalization
@model MVC.Budget.K_MYR.Models.ViewModels.LayoutModel<MVC.Budget.K_MYR.Models.ViewModels.HomeModel>

@section Stylesheets {
    @{
        <link rel="stylesheet" href="~/dist/styles-index~fiscalPlan.css" asp-append-version="true" />
    }
}

@{
    ViewData["Title"] = "Budgets";
}

<div class="content-outer-container" id="fiscalPlans-container">
    <div class="content-scrollcontainer">
        <div class="content-container">
            <div class="cards-container">                        
                @foreach(var fiscalPlan in Model.PageModel.FiscalPlans)
                {
                    var progressbarWidthIncome = (int)Math.Min(100, fiscalPlan.TotalIncome / fiscalPlan.BudgetIncome * 100); ;
                    var progressbarWidthExpenses = (int)Math.Min(100, fiscalPlan.TotalExpenses / fiscalPlan.BudgetExpenses * 100);
                    var color = progressbarWidthExpenses < 50 ? "bg-success" : progressbarWidthExpenses < 85 ? "bg-warning" : "bg-danger";

                    <div class="fiscalPlan-card" data-id="@fiscalPlan.Id">
                        <h1 class="text-center">@fiscalPlan.Name</h1>
                        <div class="progress-container">
                            <div>
                                <div class="d-flex justify-content-between">
                                    <div>Income</div>
                                    <div id="fiscalPlan_@(fiscalPlan.Id)_income" data-total="0" data-budget="0">
                                        @fiscalPlan.TotalIncome.ToString("C2", Model.Culture) / @fiscalPlan.BudgetIncome.ToString("C2", Model.Culture)
                                    </div>
                                </div>
                                <div class="progress">
                                    <div id="fiscalPlan_@(fiscalPlan.Id)_progressbar" class="progress-bar bg-success"
                                         role="progressbar" style="width: @(progressbarWidthIncome)%"
                                         aria-valuenow="@(progressbarWidthIncome)" aria-valuemin="0" aria-valuemax="100" aria-labelledby="fiscalPlan_@(fiscalPlan.Id)_balance">
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div class="d-flex justify-content-between">
                                    <div>Expenses</div>
                                    <div id="fiscalPlan_@(fiscalPlan.Id)_expenses" data-total="0" data-budget="0">
                                        @fiscalPlan.TotalExpenses.ToString("C2", Model.Culture) / @fiscalPlan.BudgetExpenses.ToString("C2", Model.Culture)
                                    </div>
                                </div>
                                <div class="progress">
                                    <div id="fiscalPlan_@(fiscalPlan.Id)_progressbar" class="progress-bar @(color)"
                                         role="progressbar" style="width: @(progressbarWidthExpenses)%"
                                         aria-valuenow="@(progressbarWidthExpenses)" aria-valuemin="0" aria-valuemax="100" aria-labelledby="fiscalPlan_@(fiscalPlan.Id)_balance">
                                    </div>
                                </div>
                            </div>
                        </div>                        
                    </div>
                }
                <div id="addFiscalPlan-card" class="add-fiscalPlan-card">
                    <svg viewBox="0 0 14 14" height="23" width="23">
                        <g id="plus">                            
                            <path  fill-rule="evenodd" d="M8 1a1 1 0 0 0 -2 0v5H1a1 1 0 0 0 0 2h5v5a1 1 0 1 0 2 0V8h5a1 1 0 1 0 0 -2H8V1Z" clip-rule="evenodd" stroke-width="1"></path>
                        </g>
                    </svg>
                </div>
            </div>            
        </div>
    </div>
</div>

@await Html.PartialAsync("_FiscalPlanModals", Model.PageModel.FiscalPlan)

@section Scripts {
    @{
        <script src="~/dist/runtime.js" asp-append-version="true"></script>
        <script src="~/dist/vendors-index~fiscalPlan.js" asp-append-version="true"></script>
        <script src="~/dist/index.js" asp-append-version="true"></script>
    }
}
